<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROTINA DA ESPOSA DE IGOR</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDKs - Vers√£o corrigida com inicializa√ß√£o segura -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <style>
        /* Mantendo todos os estilos originais exatamente como est√£o */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            background: #000 url('https://4kwallpapers.com/images/walls/thumbs_3t/14811.jpg') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 1rem;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e2e8f0;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
            }
        }
        .task-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
            cursor: grab;
        }
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .task-item:active {
            cursor: grabbing;
        }
        .task-item.dragging {
            opacity: 0.6;
            transform: rotate(5deg) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .task-item.drag-over {
            border: 2px dashed #9333ea;
            background: rgba(147, 51, 234, 0.1);
        }
        .task-item.completed {
            animation: taskComplete 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes taskComplete {
            0% { opacity: 1; transform: translateX(0); }
            50% { opacity: 0.7; transform: translateX(-10px); }
            100% { opacity: 0.5; transform: translateX(0); }
        }
        .glass-card {
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(55, 65, 81, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        @media (max-width: 640px) {
            .glass-card {
                border-radius: 0.75rem !important;
            }
        }
        .btn-primary {
            background-color: #9333ea;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #7e22ce;
        }
        .btn-glow::after {
            display: none;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .progress-ring {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        input[type="time"]::-webkit-calendar-picker-indicator,
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        .modal-content {
            background: rgba(17, 24, 39, 0.95);
            border-radius: 1rem;
            border: 1px solid rgba(55, 65, 81, 0.5);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .sync-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .drag-handle {
            cursor: grab;
            transition: color 0.2s ease;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .drag-handle:hover {
            color: #9333ea;
        }
        .filters-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }
        .filters-container::-webkit-scrollbar {
            height: 6px;
        }
        .filters-container::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 3px;
        }
        .filters-container::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        .filters-container::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }
        .connection-status.connected {
            background-color: rgba(34, 197, 94, 0.15);
            color: rgb(34, 197, 94);
        }
        .connection-status.disconnected {
            background-color: rgba(239, 68, 68, 0.15);
            color: rgb(239, 68, 68);
        }
        .status-indicator {
            display: inline-block;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 9999px;
        }
        .status-indicator.connected {
            background-color: rgb(34, 197, 94);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
        }
        .status-indicator.disconnected {
            background-color: rgb(239, 68, 68);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // Configura√ß√£o do Firebase - Mantendo suas credenciais
        const firebaseConfig = {
            apiKey: "AIzaSyBMlMkubD980K5ynN5Ud3XEYNWK3Q8RklU",
            authDomain: "db-test-7e79c.firebaseapp.com",
            projectId: "db-test-7e79c",
            storageBucket: "db-test-7e79c.firebasestorage.app",
            messagingSenderId: "472155269675",
            appId: "1:472155269675:web:99df5c6d830927e612586e",
            measurementId: "G-Z21SZ5XF50"
        };

        // Inicializar Firebase de forma segura e ass√≠ncrona
        const initializeFirebase = async () => {
            try {
                // Verificar se o Firebase j√° foi inicializado
                if (!firebase.apps.length) {
                    console.log("Inicializando Firebase...");
                    const app = firebase.initializeApp(firebaseConfig);
                    
                    // Inicializar Firestore e Auth
                    const db = firebase.firestore(app);
                    const auth = firebase.auth(app);
                    
                    // Configurar persist√™ncia offline para Firestore
                    await db.enablePersistence({ synchronizeTabs: true })
                        .catch((err) => {
                            if (err.code === 'failed-precondition') {
                                console.log('M√∫ltiplas abas abertas - usando persist√™ncia √∫nica');
                            } else if (err.code === 'unimplemented') {
                                console.log('Navegador n√£o suporta persist√™ncia offline');
                            }
                        });
                    
                    console.log("Firebase inicializado com sucesso!");
                    return { app, db, auth };
                } else {
                    console.log("Usando inst√¢ncia existente do Firebase");
                    const app = firebase.apps[0];
                    const db = firebase.firestore(app);
                    const auth = firebase.auth(app);
                    return { app, db, auth };
                }
            } catch (error) {
                console.error("Erro cr√≠tico ao inicializar Firebase:", error);
                throw new Error(`Falha na inicializa√ß√£o do Firebase: ${error.message}`);
            }
        };

        // JSON padr√£o para frases de elogio
        const defaultPhrases = {
            "completionTexts": [
                "Bom progresso! 3x mais gostosaaa üî•",
                "Ainn continue assim bb! üí™",
                "Ainn continue üî•",
            ]
        };

        // API para Firestore com inicializa√ß√£o segura
        const FirestoreTasksAPI = {
            db: null,
            auth: null,
            
            // M√©todo para configurar a inst√¢ncia do Firestore
            setFirebaseInstance: (firebaseInstance) => {
                this.db = firebaseInstance.db;
                this.auth = firebaseInstance.auth;
            },
            
            getTasksCollection: () => {
                if (!this.db) {
                    console.error("Firestore n√£o est√° inicializado");
                    throw new Error("Firestore n√£o inicializado");
                }
                return this.db.collection('tasks');
            },
            
            getPhrasesCollection: () => {
                if (!this.db) {
                    console.error("Firestore n√£o est√° inicializado");
                    throw new Error("Firestore n√£o inicializado");
                }
                return this.db.collection('phrases');
            },
            
            getCurrentUserId: async () => {
                try {
                    if (!this.auth) {
                        throw new Error("Firebase Auth n√£o inicializado");
                    }
                    
                    // Aguardar at√© que o estado de autentica√ß√£o esteja pronto
                    return new Promise((resolve) => {
                        const unsubscribe = this.auth.onAuthStateChanged(async (user) => {
                            unsubscribe();
                            if (user) {
                                resolve(user.uid);
                            } else {
                                // Fallback para usu√°rio an√¥nimo
                                let userId = localStorage.getItem('dailyTasks_userId');
                                if (!userId) {
                                    userId = `anon_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                                    localStorage.setItem('dailyTasks_userId', userId);
                                }
                                // Logar usu√°rio an√¥nimo
                                try {
                                    await this.auth.signInAnonymously();
                                } catch (error) {
                                    if (error.code !== 'auth/operation-not-allowed') {
                                        console.error("Erro ao fazer login an√¥nimo:", error);
                                    }
                                }
                                resolve(userId);
                            }
                        });
                    });
                } catch (error) {
                    console.error("Erro ao obter usu√°rio atual:", error);
                    // Fallback seguro mesmo com erro
                    let userId = localStorage.getItem('dailyTasks_userId');
                    if (!userId) {
                        userId = `anon_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        localStorage.setItem('dailyTasks_userId', userId);
                    }
                    return userId;
                }
            },
            
            // Testar conex√£o com o Firestore
            testConnection: async () => {
                try {
                    const testRef = this.getPhrasesCollection().doc('connection_test');
                    await testRef.get();
                    return true;
                } catch (error) {
                    console.error("Falha no teste de conex√£o:", error);
                    return false;
                }
            },
            
            getTasks: async () => {
                try {
                    const userId = await this.getCurrentUserId();
                    const snapshot = await this.getTasksCollection()
                        .where('userId', '==', userId)
                        .orderBy('order', 'asc')
                        .get();
                    
                    const tasks = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        tasks.push({
                            id: doc.id,
                            ...data,
                            createdAt: data.createdAt?.toDate?.() || new Date(),
                            updatedAt: data.updatedAt?.toDate?.() || new Date()
                        });
                    });
                    return tasks;
                } catch (error) {
                    console.error("Erro ao buscar tarefas:", error);
                    return [];
                }
            },
            
            getPhrases: async () => {
                try {
                    const phrasesDoc = await this.getPhrasesCollection().doc('default').get();
                    if (phrasesDoc.exists) {
                        return phrasesDoc.data();
                    }
                    return defaultPhrases;
                } catch (error) {
                    console.error("Erro ao buscar frases:", error);
                    return defaultPhrases;
                }
            },
            
            addTask: async (task) => {
                try {
                    const userId = await this.getCurrentUserId();
                    const tasksSnapshot = await this.getTasksCollection()
                        .where('userId', '==', userId)
                        .get();
                    
                    const maxOrder = tasksSnapshot.empty ? 0 : 
                        Math.max(...tasksSnapshot.docs.map(doc => doc.data().order || 0));
                    
                    const newTask = {
                        title: task.title.trim(),
                        dueDate: task.dueDate || null,
                        dueTime: task.dueTime || null,
                        done: false,
                        order: maxOrder + 1,
                        userId: userId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const docRef = await this.getTasksCollection().add(newTask);
                    return { id: docRef.id, ...newTask };
                } catch (error) {
                    console.error("Erro ao adicionar tarefa:", error);
                    throw error;
                }
            },
            
            updateTask: async (id, updates) => {
                try {
                    const taskRef = this.getTasksCollection().doc(id);
                    await taskRef.update({
                        ...updates,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    const taskDoc = await taskRef.get();
                    if (taskDoc.exists) {
                        const data = taskDoc.data();
                        return {
                            id: taskDoc.id,
                            ...data,
                            createdAt: data.createdAt?.toDate?.() || new Date(),
                            updatedAt: data.updatedAt?.toDate?.() || new Date()
                        };
                    }
                    return null;
                } catch (error) {
                    console.error("Erro ao atualizar tarefa:", error);
                    throw error;
                }
            },
            
            deleteTask: async (id) => {
                try {
                    const taskRef = this.getTasksCollection().doc(id);
                    await taskRef.delete();
                    return true;
                } catch (error) {
                    console.error("Erro ao deletar tarefa:", error);
                    throw error;
                }
            },
            
            clearCompleted: async () => {
                try {
                    const userId = await this.getCurrentUserId();
                    const snapshot = await this.getTasksCollection()
                        .where('userId', '==', userId)
                        .where('done', '==', true)
                        .get();
                    
                    const batch = this.db.batch();
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                    return true;
                } catch (error) {
                    console.error("Erro ao limpar tarefas conclu√≠das:", error);
                    throw error;
                }
            },
            
            reorderTasks: async (reorderedTasks) => {
                try {
                    const batch = this.db.batch();
                    
                    reorderedTasks.forEach((task, index) => {
                        const taskRef = this.getTasksCollection().doc(task.id);
                        batch.update(taskRef, {
                            order: index,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                    
                    await batch.commit();
                    return true;
                } catch (error) {
                    console.error("Erro ao reordenar tarefas:", error);
                    throw error;
                }
            },
            
            initializeDefaultData: async () => {
                try {
                    const phrasesRef = this.getPhrasesCollection().doc('default');
                    const phrasesDoc = await phrasesRef.get();
                    
                    if (!phrasesDoc.exists) {
                        await phrasesRef.set(defaultPhrases);
                        console.log("Frases padr√£o inicializadas no Firestore");
                    }
                } catch (error) {
                    console.error("Erro ao inicializar dados padr√£o:", error);
                }
            }
        };

        function DailyTasksApp() {
            const [showWelcome, setShowWelcome] = useState(() => {
                const welcomeShown = localStorage.getItem("dailyTasks_welcomeShown");
                return welcomeShown !== "true";
            });
            const [tasks, setTasks] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isConnected, setIsConnected] = useState(false);
            const [connectionError, setConnectionError] = useState(null);
            const [lastSync, setLastSync] = useState(null);
            const [phrases, setPhrases] = useState(defaultPhrases);
            const [title, setTitle] = useState("");
            const [dueDate, setDueDate] = useState("");
            const [dueTime, setDueTime] = useState("");
            const [editingId, setEditingId] = useState(null);
            const [filter, setFilter] = useState("all");
            const [search, setSearch] = useState("");
            const [stats, setStats] = useState({ total: 0, completed: 0, pending: 0 });
            const [showPhrasesModal, setShowPhrasesModal] = useState(false);
            const [newPhrase, setNewPhrase] = useState("");
            const [draggedTask, setDraggedTask] = useState(null);
            const [dragOverTask, setDragOverTask] = useState(null);
            
            const tasksUnsubscribeRef = useRef(null);
            const phrasesUnsubscribeRef = useRef(null);
            const isMountedRef = useRef(true);
            
            // Monitorar conex√£o com a internet
            useEffect(() => {
                const handleOnline = () => {
                    console.log("Conex√£o restaurada");
                    setIsConnected(true);
                    setConnectionError(null);
                };
                
                const handleOffline = () => {
                    console.log("Sem conex√£o com a internet");
                    setIsConnected(false);
                    setConnectionError("Sem conex√£o com a internet");
                };
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // Verificar conex√£o inicial
                setIsConnected(navigator.onLine);
                
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);
            
            // Inicializar Firebase e dados - AGORA ASS√çNCRONO
            useEffect(() => {
                let isInitialized = false;
                
                const initApp = async () => {
                    if (isInitialized) return;
                    isInitialized = true;
                    
                    setIsLoading(true);
                    
                    try {
                        // Inicializar Firebase
                        console.log("Iniciando inicializa√ß√£o do Firebase...");
                        const firebaseInstance = await initializeFirebase();
                        
                        // Configurar a inst√¢ncia na API
                        FirestoreTasksAPI.setFirebaseInstance(firebaseInstance);
                        
                        // Testar conex√£o com o Firestore
                        console.log("Testando conex√£o com Firestore...");
                        const connectionTest = await FirestoreTasksAPI.testConnection();
                        if (!connectionTest) {
                            throw new Error("N√£o foi poss√≠vel conectar ao Firestore");
                        }
                        
                        // Inicializar dados padr√£o
                        console.log("Inicializando dados padr√£o...");
                        await FirestoreTasksAPI.initializeDefaultData();
                        
                        // Carregar dados iniciais
                        console.log("Carregando dados iniciais...");
                        const [initialTasks, initialPhrases] = await Promise.all([
                            FirestoreTasksAPI.getTasks(),
                            FirestoreTasksAPI.getPhrases()
                        ]);
                        
                        if (isMountedRef.current) {
                            setTasks(initialTasks);
                            setPhrases(initialPhrases);
                            setLastSync(new Date());
                            setIsConnected(true);
                            setConnectionError(null);
                            console.log("Dados carregados com sucesso!");
                        }
                        
                        // Setup listeners em tempo real
                        console.log("Configurando listeners em tempo real...");
                        setupRealtimeListeners();
                        
                    } catch (error) {
                        console.error("Erro ao inicializar app:", error);
                        setConnectionError(error.message || "Erro ao conectar com o banco de dados");
                        setIsConnected(false);
                        alert(`Erro de inicializa√ß√£o: ${error.message || 'N√£o foi poss√≠vel conectar ao banco de dados'}`);
                    } finally {
                        if (isMountedRef.current) {
                            setIsLoading(false);
                        }
                    }
                };
                
                initApp();
                
                return () => {
                    isMountedRef.current = false;
                    isInitialized = true;
                    // Cleanup dos listeners
                    if (tasksUnsubscribeRef.current) {
                        try {
                            tasksUnsubscribeRef.current();
                        } catch (error) {
                            console.error("Erro ao limpar listener de tasks:", error);
                        }
                    }
                    if (phrasesUnsubscribeRef.current) {
                        try {
                            phrasesUnsubscribeRef.current();
                        } catch (error) {
                            console.error("Erro ao limpar listener de frases:", error);
                        }
                    }
                };
            }, []);
            
            const setupRealtimeListeners = () => {
                try {
                    FirestoreTasksAPI.getCurrentUserId().then(userId => {
                        if (!userId || !isMountedRef.current) return;
                        
                        console.log("Configurando listeners para usu√°rio:", userId);
                        
                        // Listener para tasks
                        tasksUnsubscribeRef.current = FirestoreTasksAPI.getTasksCollection()
                            .where('userId', '==', userId)
                            .orderBy('order', 'asc')
                            .onSnapshot({ includeMetadataChanges: true }, (snapshot) => {
                                if (snapshot.metadata.fromCache && !snapshot.metadata.hasPendingWrites) {
                                    console.log("Dados carregados do cache");
                                    return;
                                }
                                
                                const tasksData = [];
                                snapshot.forEach(doc => {
                                    const data = doc.data();
                                    tasksData.push({
                                        id: doc.id,
                                        ...data,
                                        createdAt: data.createdAt?.toDate?.() || new Date(),
                                        updatedAt: data.updatedAt?.toDate?.() || new Date()
                                    });
                                });
                                
                                if (isMountedRef.current) {
                                    setTasks(tasksData);
                                    setLastSync(new Date());
                                    console.log("Tasks atualizadas em tempo real:", tasksData.length);
                                }
                            }, error => {
                                console.error("Erro no listener de tasks:", error);
                                if (isMountedRef.current) {
                                    setIsConnected(false);
                                    setConnectionError(`Erro ao ouvir tarefas: ${error.message}`);
                                }
                            });
                        
                        // Listener para frases
                        phrasesUnsubscribeRef.current = FirestoreTasksAPI.getPhrasesCollection().doc('default')
                            .onSnapshot({ includeMetadataChanges: true }, (snapshot) => {
                                if (snapshot.metadata.fromCache) return;
                                
                                if (snapshot.exists && isMountedRef.current) {
                                    setPhrases(snapshot.data());
                                    console.log("Frases atualizadas em tempo real");
                                }
                            }, error => {
                                console.error("Erro no listener de frases:", error);
                            });
                    });
                } catch (error) {
                    console.error("Erro ao configurar listeners:", error);
                    if (isMountedRef.current) {
                        setIsConnected(false);
                        setConnectionError(`Erro ao configurar listeners: ${error.message}`);
                    }
                }
            };
            
            // Demais fun√ß√µes permanecem as mesmas (createDate, addOrUpdateTask, toggleDone, etc.)
            // Vou incluir apenas as fun√ß√µes que foram modificadas
            
            const createDate = (dateString, timeString = null) => {
                if (!dateString) return null;
                const [year, month, day] = dateString.split('-').map(Number);
                let date = new Date(year, month - 1, day);
                if (timeString) {
                    const [hours, minutes] = timeString.split(':').map(Number);
                    date.setHours(hours, minutes, 0, 0);
                } else {
                    date.setHours(23, 59, 0, 0);
                }
                return date;
            };
            
            const addOrUpdateTask = useCallback(async (e) => {
                e.preventDefault();
                if (!title.trim() || !isConnected) {
                    if (!isConnected) {
                        alert("Voc√™ est√° offline. Verifique sua conex√£o com a internet.");
                    }
                    return;
                }
                
                setIsLoading(true);
                try {
                    if (editingId) {
                        const updatedTask = await FirestoreTasksAPI.updateTask(editingId, {
                            title: title.trim(),
                            dueDate: dueDate || null,
                            dueTime: dueTime || null
                        });
                        if (updatedTask && isMountedRef.current) {
                            setEditingId(null);
                        }
                    } else {
                        const newTask = {
                            title: title.trim(),
                            dueDate: dueDate || null,
                            dueTime: dueTime || null,
                            done: false,
                        };
                        await FirestoreTasksAPI.addTask(newTask);
                    }
                    
                    if (isMountedRef.current) {
                        setTitle("");
                        setDueDate("");
                        setDueTime("");
                    }
                } catch (error) {
                    console.error("Erro ao salvar tarefa:", error);
                    alert(`Erro ao salvar tarefa: ${error.message || 'Tente novamente mais tarde'}`);
                } finally {
                    if (isMountedRef.current) {
                        setIsLoading(false);
                    }
                }
            }, [title, dueDate, dueTime, editingId, isConnected]);
            
            // As demais fun√ß√µes (toggleDone, startEdit, removeTask, etc.) permanecem as mesmas
            // do c√≥digo original, pois o problema principal era a inicializa√ß√£o do Firestore
            
            // Fun√ß√µes mantidas id√™nticas (toggleDone, startEdit, removeTask, clearCompleted, refreshTasks, etc.)
            const toggleDone = useCallback(async (id) => {
                if (!isConnected) return;
                
                try {
                    const task = tasks.find(t => t.id === id);
                    if (task) {
                        await FirestoreTasksAPI.updateTask(id, { done: !task.done });
                    }
                } catch (error) {
                    console.error("Erro ao atualizar status da tarefa:", error);
                    alert("Erro ao atualizar tarefa. Verifique sua conex√£o.");
                }
            }, [tasks, isConnected]);
            
            const startEdit = useCallback((t) => {
                setEditingId(t.id);
                setTitle(t.title);
                setDueDate(t.dueDate || "");
                setDueTime(t.dueTime || "");
            }, []);
            
            const removeTask = useCallback(async (id) => {
                if (!isConnected || !confirm("Tem certeza que deseja excluir esta tarefa?")) return;
                
                try {
                    await FirestoreTasksAPI.deleteTask(id);
                } catch (error) {
                    console.error("Erro ao excluir tarefa:", error);
                    alert("Erro ao excluir tarefa. Tente novamente.");
                }
            }, [isConnected]);
            
            const clearCompleted = useCallback(async () => {
                if (!isConnected || !confirm("Remover todas as tarefas conclu√≠das?")) return;
                
                try {
                    await FirestoreTasksAPI.clearCompleted();
                } catch (error) {
                    console.error("Erro ao limpar tarefas conclu√≠das:", error);
                    alert("Erro ao limpar tarefas conclu√≠das. Tente novamente.");
                }
            }, [isConnected]);
            
            const refreshTasks = useCallback(async () => {
                if (!isConnected) return;
                
                setIsLoading(true);
                try {
                    const freshTasks = await FirestoreTasksAPI.getTasks();
                    if (isMountedRef.current) {
                        setTasks(freshTasks);
                        setLastSync(new Date());
                    }
                } catch (error) {
                    console.error("Erro ao atualizar tarefas:", error);
                } finally {
                    if (isMountedRef.current) {
                        setIsLoading(false);
                    }
                }
            }, [isConnected]);
            
            // Fun√ß√µes para Drag and Drop
            const handleDragStart = useCallback((e, task) => {
                setDraggedTask(task);
                e.dataTransfer.effectAllowed = 'move';
                setTimeout(() => {
                    e.target.classList.add('dragging');
                }, 0);
            }, []);
            
            const handleDragOver = useCallback((e, task) => {
                e.preventDefault();
                if (draggedTask && draggedTask.id !== task.id) {
                    setDragOverTask(task);
                }
            }, [draggedTask]);
            
            const handleDragLeave = useCallback((e) => {
                e.preventDefault();
                setDragOverTask(null);
            }, []);
            
            const handleDrop = useCallback(async (e, targetTask) => {
                e.preventDefault();
                if (!isConnected || !draggedTask || draggedTask.id === targetTask.id) {
                    setDraggedTask(null);
                    setDragOverTask(null);
                    return;
                }
                
                try {
                    const taskList = [...tasks];
                    const draggedIndex = taskList.findIndex(t => t.id === draggedTask.id);
                    const targetIndex = taskList.findIndex(t => t.id === targetTask.id);
                    
                    if (draggedIndex !== -1 && targetIndex !== -1) {
                        const [movedTask] = taskList.splice(draggedIndex, 1);
                        taskList.splice(targetIndex, 0, movedTask);
                        
                        setIsLoading(true);
                        await FirestoreTasksAPI.reorderTasks(taskList);
                    }
                } catch (error) {
                    console.error("Erro ao reordenar tarefas:", error);
                    alert("Erro ao reordenar tarefas. Tente novamente.");
                } finally {
                    setDraggedTask(null);
                    setDragOverTask(null);
                    setIsLoading(false);
                }
            }, [draggedTask, tasks, isConnected]);
            
            const handleDragEnd = useCallback((e) => {
                e.target.classList.remove('dragging');
                setDraggedTask(null);
                setDragOverTask(null);
            }, []);
            
            const getTaskPriority = (task) => {
                if (task.done) return "none";
                if (!task.dueDate) return "none";
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const taskDate = createDate(task.dueDate);
                if (!taskDate) return "none";
                const taskDateOnly = new Date(taskDate.getFullYear(), taskDate.getMonth(), taskDate.getDate());
                if (taskDateOnly.getTime() === today.getTime()) {
                    if (task.dueTime) {
                        return taskDate < now ? "urgent" : "high";
                    }
                    return "high";
                }
                if (taskDateOnly < today) return "urgent";
                if (taskDateOnly.getTime() === tomorrow.getTime()) return "medium";
                const dayAfterTomorrow = new Date(tomorrow);
                dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 1);
                const inThreeDays = new Date(tomorrow);
                inThreeDays.setDate(inThreeDays.getDate() + 2);
                if (taskDateOnly >= dayAfterTomorrow && taskDateOnly <= inThreeDays) return "medium";
                return "low";
            };
            
            const getPriorityBadge = (priority) => {
                const badges = {
                    urgent: { text: "Atrasado", color: "bg-red-900 text-red-300 border-red-700" },
                    high: { text: "Hoje", color: "bg-purple-900 text-purple-200 border-purple-700" },
                    medium: { text: "Em breve", color: "bg-amber-900 text-amber-200 border-amber-700" },
                    low: { text: "Futuro", color: "bg-emerald-900 text-emerald-200 border-emerald-700" },
                    none: { text: "Sem data", color: "bg-gray-800 text-gray-300 border-gray-700" }
                };
                return badges[priority];
            };
            
            const formatDate = (dateString) => {
                if (!dateString) return '';
                const date = createDate(dateString);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const tomorrowOnly = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());
                if (dateOnly.getTime() === todayOnly.getTime()) {
                    return 'Hoje';
                } else if (dateOnly.getTime() === tomorrowOnly.getTime()) {
                    return 'Amanh√£';
                } else {
                    return date.toLocaleDateString('pt-BR');
                }
            };
            
            // Calcular estat√≠sticas
            useEffect(() => {
                const calculateStats = () => {
                    const now = new Date();
                    const completed = tasks.filter(t => t.done).length;
                    const pending = tasks.filter(t => {
                        if (t.done) return false;
                        if (t.dueDate) {
                            const taskDate = createDate(t.dueDate, t.dueTime);
                            return taskDate && taskDate < now;
                        }
                        return false;
                    }).length;
                    setStats({
                        total: tasks.length,
                        completed,
                        pending,
                        completionRate: tasks.length > 0 ? Math.round((completed / tasks.length) * 100) : 0
                    });
                };
                calculateStats();
            }, [tasks]);
            
            useEffect(() => {
                if (tasks.length > 0) {
                    setShowWelcome(false);
                }
            }, [tasks]);
            
            const getCompletionText = () => {
                if (stats.completionRate === 100 && phrases.completionTexts.length > 0) {
                    return phrases.completionTexts[0];
                }
                if (stats.completionRate >= 80 && phrases.completionTexts.length > 1) {
                    return phrases.completionTexts[1];
                }
                if (stats.completionRate >= 60 && phrases.completionTexts.length > 2) {
                    return phrases.completionTexts[2];
                }
                if (stats.completionRate >= 40 && phrases.completionTexts.length > 3) {
                    return phrases.completionTexts[3];
                }
                if (phrases.completionTexts.length > 4) {
                    return phrases.completionTexts[4];
                }
                return "Continue assim!";
            };
            
            const handleStart = useCallback(() => {
                setShowWelcome(false);
                localStorage.setItem("dailyTasks_welcomeShown", "true");
            }, []);
            
            // Fun√ß√µes para gerenciar frases
            const addPhrase = async () => {
                if (!newPhrase.trim() || !isConnected) return;
                
                try {
                    const updatedPhrases = {
                        ...phrases,
                        completionTexts: [...phrases.completionTexts, newPhrase.trim()]
                    };
                    await FirestoreTasksAPI.getPhrasesCollection().doc('default').set(updatedPhrases);
                    setNewPhrase("");
                } catch (error) {
                    console.error("Erro ao adicionar frase:", error);
                    alert("Erro ao adicionar frase. Tente novamente.");
                }
            };
            
            const removePhrase = async (index) => {
                if (!isConnected || !confirm("Tem certeza que deseja remover esta frase?")) return;
                
                try {
                    const updatedPhrases = {
                        ...phrases,
                        completionTexts: phrases.completionTexts.filter((_, i) => i !== index)
                    };
                    await FirestoreTasksAPI.getPhrasesCollection().doc('default').set(updatedPhrases);
                } catch (error) {
                    console.error("Erro ao remover frase:", error);
                    alert("Erro ao remover frase. Tente novamente.");
                }
            };
            
            const resetPhrases = async () => {
                if (!isConnected || !confirm("Isso restaurar√° as frases padr√£o. Tem certeza?")) return;
                
                try {
                    await FirestoreTasksAPI.getPhrasesCollection().doc('default').set(defaultPhrases);
                } catch (error) {
                    console.error("Erro ao resetar frases:", error);
                    alert("Erro ao resetar frases. Tente novamente.");
                }
            };
            
            const visibleTasks = tasks.filter((t) => {
                if (search && !t.title.toLowerCase().includes(search.toLowerCase())) return false;
                if (filter === "all") return true;
                if (filter === "completed") return t.done;
                if (filter === "pending") return !t.done;
                if (filter === "overdue") {
                    if (t.done || !t.dueDate) return false;
                    const now = new Date();
                    const taskDate = createDate(t.dueDate, t.dueTime);
                    return taskDate && taskDate < now;
                }
                if (filter === "today") {
                    if (t.done || !t.dueDate) return false;
                    const today = new Date();
                    const taskDate = createDate(t.dueDate);
                    const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    const taskDateOnly = new Date(taskDate.getFullYear(), taskDate.getMonth(), taskDate.getDate());
                    return taskDateOnly.getTime() === todayOnly.getTime();
                }
                return true;
            });
            
            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    {showWelcome && (
                        <div className="glass-card rounded-2xl p-6 mb-6 text-center animate-fade-in-up border border-gray-700 w-full max-w-md">
                            <div className="flex justify-center mb-4">
                                <div className="w-14 h-14 rounded-lg bg-purple-600 flex items-center justify-center">
                                    <i className="fas fa-tasks text-white text-xl"></i>
                                </div>
                            </div>
                            <h2 className="text-xl md:text-2xl font-bold mb-3 text-gray-200">
                                Bem-vindo delicia, vamo querer se organizar?
                            </h2>
                            <p className="text-gray-400 mb-5 max-w-md mx-auto text-sm">
                                Organize sua rotina ai, acompanhe seu progresso e conquiste seus objetivos di√°rios com facilidade. hehehe.
                            </p>
                            <button 
                                onClick={handleStart}
                                className="px-5 py-2.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all duration-300 shadow-md"
                            >
                                Come√ßar Agora
                            </button>
                        </div>
                    )}
                    <div className="w-full max-w-4xl">
                        <div className={`glass-card rounded-2xl shadow-lg overflow-hidden border border-gray-700 ${showWelcome ? 'hidden' : 'block'}`}>
                            <div className="p-5 border-b border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                    <div className="flex items-center gap-3">
                                        <div className="flex items-center gap-1">
                                            <i className="fas fa-check-circle text-green-400"></i>
                                            <span className="font-medium text-gray-200">{stats.completed}/{stats.total}</span>
                                        </div>
                                        <div className="w-1 h-1 rounded-full bg-gray-600"></div>
                                        <div className="flex items-center gap-1">
                                            <i className="fas fa-exclamation-circle text-red-400"></i>
                                            <span className="font-medium text-red-300">{stats.pending}</span>
                                        </div>
                                        <div className="connection-status">
                                            <span className={`status-indicator ${isConnected ? 'connected' : 'disconnected'}`}></span>
                                            <span>{isConnected ? 'Conectado' : connectionError || 'Desconectado'}</span>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={refreshTasks}
                                            disabled={!isConnected || isLoading}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-blue-300 hover:bg-blue-900/30 border border-blue-700/50 transition-all duration-300 flex items-center gap-1.5 text-sm disabled:opacity-50"
                                            title="Atualizar tarefas"
                                        >
                                            <i className="fas fa-sync-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Atualizar</span>
                                        </button>
                                        <button
                                            onClick={() => setShowPhrasesModal(true)}
                                            disabled={isLoading}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-purple-300 hover:bg-purple-900/30 border border-purple-700/50 transition-all duration-300 flex items-center gap-1.5 text-sm disabled:opacity-50"
                                        >
                                            <i className="fas fa-comment-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Frases</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {/* Restante do componente mantido id√™ntico ao original */}
                            <div className="p-5 border-b border-gray-700">
                                <form onSubmit={addOrUpdateTask} className="relative">
                                    <div className="flex flex-col gap-3">
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <div className="flex-1">
                                                <div className="relative">
                                                    <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-purple-400">
                                                        <i className={editingId ? "fas fa-edit" : "fas fa-plus"}></i>
                                                    </div>
                                                    <input
                                                        value={title}
                                                        onChange={(e) => setTitle(e.target.value)}
                                                        placeholder={editingId ? "Editar tarefa..." : "O que voc√™ precisa fazer hoje?"}
                                                        className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent transition-all duration-300 text-white placeholder-gray-500"
                                                        disabled={isLoading || !isConnected}
                                                    />
                                                </div>
                                            </div>
                                            <div className="flex flex-col sm:flex-row gap-3">
                                                <button
                                                    type="submit"
                                                    disabled={isLoading || !isConnected || !title.trim()}
                                                    className="px-4 py-3 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-medium shadow-md transition-all duration-300 flex items-center justify-center min-w-[110px] disabled:opacity-50 disabled:cursor-not-allowed"
                                                >
                                                    <span className="flex items-center gap-1.5">
                                                        {isLoading ? (
                                                            <i className="fas fa-spinner fa-spin"></i>
                                                        ) : editingId ? (
                                                            <>
                                                                <i className="fas fa-save"></i>
                                                                <span className="hidden sm:inline text-sm">Salvar</span>
                                                            </>
                                                        ) : (
                                                            <>
                                                                <i className="fas fa-plus"></i>
                                                                <span className="hidden sm:inline text-sm">Adicionar</span>
                                                            </>
                                                        )}
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <div className="relative flex-1">
                                                <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400">
                                                    <i className="far fa-calendar"></i>
                                                </div>
                                                <input
                                                    type="date"
                                                    value={dueDate}
                                                    onChange={(e) => setDueDate(e.target.value)}
                                                    className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent transition-all duration-300"
                                                    disabled={isLoading || !isConnected}
                                                />
                                            </div>
                                            <div className="relative flex-1">
                                                <div className="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400">
                                                    <i className="far fa-clock"></i>
                                                </div>
                                                <input
                                                    type="time"
                                                    value={dueTime}
                                                    onChange={(e) => setDueTime(e.target.value)}
                                                    className="w-full pl-10 pr-4 py-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent transition-all duration-300"
                                                    disabled={isLoading || !isConnected}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div className="p-5 border-b border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                    <div className="filters-container">
                                        {[
                                            { label: "Todas", value: "all", icon: "fas fa-list" },
                                            { label: "Pendentes", value: "pending", icon: "fas fa-hourglass-half" },
                                            { label: "Hoje", value: "today", icon: "fas fa-calendar-day" },
                                            { label: "Atrasadas", value: "overdue", icon: "fas fa-exclamation-triangle" },
                                            { label: "", value: "completed", icon: "fas fa-check-circle" }
                                        ].map(({ label, value, icon }) => (
                                            <button
                                                key={value}
                                                onClick={() => setFilter(value)}
                                                disabled={isLoading}
                                                className={`flex items-center justify-center gap-1.5 px-3.5 py-1.5 rounded-lg font-medium transition-all duration-300 text-sm whitespace-nowrap min-w-[4.5rem] ${
                                                    filter === value
                                                        ? "bg-purple-600 text-white"
                                                        : "bg-gray-800 text-gray-300 hover:bg-gray-700 border border-gray-700"
                                                } ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                title={value === "completed" ? "Conclu√≠das" : ""}
                                            >
                                                <i className={icon} style={{fontSize: '0.85em'}}></i>
                                                <span>{label}</span>
                                            </button>
                                        ))}
                                    </div>
                                    <div className="flex gap-2 mt-3 md:mt-0">
                                        <div className="relative">
                                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                                <i className="fas fa-search"></i>
                                            </div>
                                            <input
                                                value={search}
                                                onChange={(e) => setSearch(e.target.value)}
                                                placeholder="Pesquisar tarefas..."
                                                className="pl-9 pr-3.5 py-1.5 w-full md:w-56 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent transition-all duration-300 text-white placeholder-gray-500 text-sm"
                                                disabled={isLoading}
                                            />
                                        </div>
                                        <button
                                            onClick={clearCompleted}
                                            disabled={isLoading || !isConnected}
                                            className="px-3 py-1.5 rounded-lg text-gray-300 hover:text-red-300 hover:bg-red-900/30 border border-red-700/50 transition-all duration-300 flex items-center gap-1.5 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            <i className="fas fa-trash-alt" style={{fontSize: '0.85em'}}></i>
                                            <span className="hidden sm:inline">Limpar</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <main className="p-5">
                                {isLoading && tasks.length === 0 ? (
                                    <div className="text-center py-12">
                                        <div className="max-w-md mx-auto">
                                            <div className="text-5xl mb-3 text-purple-500">
                                                <i className="fas fa-spinner fa-spin"></i>
                                            </div>
                                            <h3 className="text-xl font-bold mb-1 text-gray-200">
                                                {isConnected ? "Carregando tarefas..." : "Sem conex√£o com a internet"}
                                            </h3>
                                            <p className="text-gray-400 text-sm">
                                                {connectionError || (isConnected ? "Conectando ao banco de dados..." : "Verifique sua conex√£o e tente novamente")}
                                            </p>
                                        </div>
                                    </div>
                                ) : visibleTasks.length === 0 ? (
                                    <div className="text-center py-12">
                                        {filter === "completed" ? (
                                            <div className="max-w-md mx-auto">
                                                <div className="text-5xl mb-3 text-green-400">
                                                    <i className="fas fa-check-circle"></i>
                                                </div>
                                                <h3 className="text-xl font-bold mb-1 text-green-300">
                                                    Tudo Conclu√≠do!
                                                </h3>
                                                <p className="text-gray-400 text-sm">
                                                    Aiii! Voc√™ est√° √† frente de suas tarefas. Adicione novos objetivos para continuar seu progresso.
                                                </p>
                                            </div>
                                        ) : (
                                            <div className="max-w-md mx-auto">
                                                <div className="text-5xl mb-3 text-purple-500">
                                                    <i className="fas fa-clipboard-list"></i>
                                                </div>
                                                <h3 className="text-xl font-bold mb-1 text-gray-200">
                                                    {search ? "Nenhuma tarefa encontrada" : "Nenhuma tarefa aqui"}
                                                </h3>
                                                <p className="text-gray-400 text-sm">
                                                    {search 
                                                        ? "Tente ajustar sua busca ou limpar o filtro."
                                                        : "Adicione sua primeira tarefa e comece a organizar seu dia!"}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-2.5">
                                        {visibleTasks.map((t, index) => {
                                            const priority = getTaskPriority(t);
                                            const badge = getPriorityBadge(priority);
                                            const isOverdue = priority === "urgent" && !t.done;
                                            const isDragging = draggedTask && draggedTask.id === t.id;
                                            const isDragOver = dragOverTask && dragOverTask.id === t.id;
                                            return (
                                                <div
                                                    key={t.id}
                                                    draggable={!isLoading && isConnected}
                                                    onDragStart={(e) => handleDragStart(e, t)}
                                                    onDragOver={(e) => handleDragOver(e, t)}
                                                    onDragLeave={handleDragLeave}
                                                    onDrop={(e) => handleDrop(e, t)}
                                                    onDragEnd={handleDragEnd}
                                                    className={`task-item ${
                                                        t.done ? 'completed' : ''
                                                    } ${isDragging ? 'dragging' : ''} ${
                                                        isDragOver ? 'drag-over' : ''
                                                    } glass-card rounded-lg p-3.5 border ${
                                                        isOverdue ? 'border-red-700/50' : 
                                                        t.done ? 'border-green-700/30' : 
                                                        'border-gray-700'
                                                    } ${
                                                        editingId === t.id ? 'ring-2 ring-purple-500/50' : ''
                                                    } ${isLoading || !isConnected ? 'opacity-50' : ''}`}
                                                >
                                                    <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                                        <div className="flex items-start gap-3 flex-1">
                                                            <div className="mt-0.5">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={t.done}
                                                                    onChange={() => toggleDone(t.id)}
                                                                    disabled={isLoading || !isConnected}
                                                                    className="w-4.5 h-4.5 rounded border-gray-600 bg-gray-800 text-purple-600 focus:ring-purple-600 focus:ring-offset-0 cursor-pointer transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                                                    aria-label={`Marcar ${t.title}`}
                                                                />
                                                            </div>
                                                            <div className="flex-1 min-w-0">
                                                                <div className={`text-sm font-medium transition-all duration-300 ${
                                                                    t.done ? "line-through text-gray-500" : "text-gray-200"
                                                                }`}>
                                                                    {t.title}
                                                                </div>
                                                                <div className="flex flex-wrap items-center gap-2 mt-1">
                                                                    <span className={`text-xs px-2 py-0.5 rounded-full border ${badge.color}`}>
                                                                        <i className="fas fa-clock mr-0.5 text-[0.75em]"></i>
                                                                        {badge.text}
                                                                    </span>
                                                                    {t.dueDate && (
                                                                        <span className="text-xs text-gray-500">
                                                                            <i className="far fa-calendar mr-0.5 text-[0.75em]"></i>
                                                                            {formatDate(t.dueDate)}
                                                                        </span>
                                                                    )}
                                                                    {t.dueTime && (
                                                                        <span className="text-xs text-gray-500">
                                                                            <i className="far fa-clock mr-0.5 text-[0.75em]"></i>
                                                                            {t.dueTime}
                                                                        </span>
                                                                    )}
                                                                    {t.updatedAt && (
                                                                        <span className="text-xs text-gray-600" title={`Atualizado em: ${new Date(t.updatedAt).toLocaleString('pt-BR')}`}>
                                                                            <i className="fas fa-history mr-0.5 text-[0.75em]"></i>
                                                                            {new Date(t.updatedAt).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                                                                        </span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="flex flex-wrap gap-1.5 justify-end">
                                                            <div className="drag-handle text-gray-400 p-1.5 cursor-grab" title="Arrastar para reordenar">
                                                                <i className="fas fa-grip-vertical"></i>
                                                            </div>
                                                            <button 
                                                                onClick={() => startEdit(t)} 
                                                                disabled={isLoading || !isConnected}
                                                                className="p-1.5 rounded-md text-gray-400 hover:text-purple-400 hover:bg-purple-900/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                                                title="Editar"
                                                            >
                                                                <i className="fas fa-edit text-sm"></i>
                                                            </button>
                                                            <button 
                                                                onClick={() => removeTask(t.id)} 
                                                                disabled={isLoading || !isConnected}
                                                                className="p-1.5 rounded-md text-gray-400 hover:text-red-400 hover:bg-red-900/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                                                title="Excluir"
                                                            >
                                                                <i className="fas fa-trash-alt text-sm"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </main>
                            <div className="p-5 bg-gray-900 border-t border-gray-700">
                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-20 h-20 relative">
                                            <svg className="w-full h-full" viewBox="0 0 36 36">
                                                <circle
                                                    className="text-gray-700"
                                                    strokeWidth="2.5"
                                                    strokeDasharray="100"
                                                    strokeDashoffset="0"
                                                    fill="none"
                                                    cx="18"
                                                    cy="18"
                                                    r="16"
                                                />
                                                <circle
                                                    className="progress-ring text-purple-600"
                                                    strokeWidth="2.5"
                                                    strokeDasharray="100"
                                                    strokeDashoffset={`${100 - stats.completionRate}`}
                                                    fill="none"
                                                    cx="18"
                                                    cy="18"
                                                    r="16"
                                                />
                                                <text
                                                    x="18"
                                                    y="20"
                                                    className="text-gray-200 text-sm font-bold text-center fill-current"
                                                    textAnchor="middle"
                                                >
                                                    {stats.completionRate}%
                                                </text>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 className="text-base font-bold text-purple-400">
                                                {getCompletionText()}
                                            </h3>
                                            <p className="text-gray-400 text-xs">
                                                {stats.total > 0 
                                                    ? `Voc√™ completou ${stats.completed} de ${stats.total} tarefas.`
                                                    : 'Adicione sua primeira tarefa para come√ßar!'}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="text-center md:text-right">
                                        <p className="text-xs text-gray-400">
                                            <i className="far fa-clock mr-1.5 text-[0.8em]"></i>
                                            {lastSync ? `√öltima sincroniza√ß√£o: ${lastSync.toLocaleTimeString('pt-BR')}` : 'Aguardando sincroniza√ß√£o...'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {showPhrasesModal && (
                            <div className="modal-overlay">
                                <div className="modal-content p-5">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-bold text-gray-200">Gerenciar Frases de Elogio</h3>
                                        <button 
                                            onClick={() => setShowPhrasesModal(false)}
                                            className="text-gray-400 hover:text-white"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div className="mb-4">
                                        <div className="flex gap-2 mb-3">
                                            <input
                                                value={newPhrase}
                                                onChange={(e) => setNewPhrase(e.target.value)}
                                                placeholder="Adicionar nova frase..."
                                                className="flex-1 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent text-white placeholder-gray-500 text-sm"
                                                disabled={isLoading || !isConnected}
                                            />
                                            <button
                                                onClick={addPhrase}
                                                disabled={isLoading || !isConnected || !newPhrase.trim()}
                                                className="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm disabled:opacity-50"
                                            >
                                                Adicionar
                                            </button>
                                        </div>
                                        <div className="max-h-60 overflow-y-auto">
                                            {phrases.completionTexts.map((phrase, index) => (
                                                <div key={index} className="flex items-center justify-between p-2 bg-gray-800 rounded-lg mb-2">
                                                    <span className="text-gray-200 text-sm">{phrase}</span>
                                                    <button
                                                        onClick={() => removePhrase(index)}
                                                        disabled={isLoading || !isConnected}
                                                        className="text-red-400 hover:text-red-300 ml-2 disabled:opacity-50"
                                                    >
                                                        <i className="fas fa-trash-alt text-sm"></i>
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="flex justify-between">
                                        <button
                                            onClick={resetPhrases}
                                            disabled={isLoading || !isConnected}
                                            className="px-3 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg text-sm disabled:opacity-50"
                                        >
                                            Restaurar Padr√£o
                                        </button>
                                        <button
                                            onClick={() => setShowPhrasesModal(false)}
                                            className="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm"
                                        >
                                            Fechar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        <footer className="mt-5 text-center text-xs text-gray-600">
                            <p>
                                <i className="fas fa-code mr-1"></i>
                                Desenvolvido com ‚ù§Ô∏è By D3xt4rz | 
                                <i className="fas fa-database ml-2 mr-1"></i>
                                {isConnected ? 'Conectado ao Firebase' : 'Desconectado do Firebase'} |
                                <i className="fas fa-arrows-alt ml-2 mr-1"></i>
                                Arraste para reordenar
                            </p>
                        </footer>
                    </div>
                </div>
            );
        }
        
        // Renderizar a aplica√ß√£o
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DailyTasksApp />);
    </script>
</body>
</html>
